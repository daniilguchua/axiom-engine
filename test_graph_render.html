<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHOST Engine - Revised Graph Designs</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0f;
            color: #fafafa;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 40px 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 30px;
            border-bottom: 2px solid #2a2a3a;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #A78BFA 0%, #34D399 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }
        
        .subtitle {
            color: #94A3B8;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        .tier-section {
            margin-bottom: 80px;
            padding: 40px;
            background: #12121a;
            border: 2px solid #2a2a3a;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .tier-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--tier-color), transparent);
        }
        
        .tier-section.explorer {
            --tier-color: #34D399;
        }
        
        .tier-section.engineer {
            --tier-color: #60A5FA;
        }
        
        .tier-section.architect {
            --tier-color: #A78BFA;
        }
        
        .tier-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .tier-badge {
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .tier-badge.explorer {
            background: rgba(52, 211, 153, 0.15);
            color: #34D399;
            border: 1px solid #34D399;
        }
        
        .tier-badge.engineer {
            background: rgba(96, 165, 250, 0.15);
            color: #60A5FA;
            border: 1px solid #60A5FA;
        }
        
        .tier-badge.architect {
            background: rgba(167, 139, 250, 0.15);
            color: #A78BFA;
            border: 1px solid #A78BFA;
        }
        
        .tier-title {
            font-size: 2rem;
            color: #fff;
            margin: 0;
        }
        
        .tier-meta {
            display: flex;
            gap: 30px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(26, 26, 36, 0.5);
            border-radius: 8px;
            border-left: 3px solid var(--tier-color);
        }
        
        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .meta-label {
            font-size: 0.85rem;
            color: #94A3B8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .meta-value {
            font-size: 1.1rem;
            color: #fff;
            font-weight: 600;
        }
        
        .graph-container {
            background: #1a1a24;
            padding: 60px 40px;
            border-radius: 12px;
            margin-top: 30px;
            border: 1px solid #2a2a3a;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .graph-container .mermaid {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        .description {
            color: #CBD5E1;
            font-size: 1.05rem;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(26, 26, 36, 0.3);
            border-radius: 8px;
        }
        
        /* Subgraph Gradient Backgrounds */
        .tier-section.explorer .mermaid g.cluster rect {
            fill: rgba(52, 211, 153, 0.08) !important;
            stroke: rgba(52, 211, 153, 0.3) !important;
        }
        
        .tier-section.engineer .mermaid g.cluster rect {
            fill: rgba(96, 165, 250, 0.08) !important;
            stroke: rgba(96, 165, 250, 0.3) !important;
        }
        
        .tier-section.architect .mermaid g.cluster rect {
            fill: rgba(167, 139, 250, 0.08) !important;
            stroke: rgba(167, 139, 250, 0.3) !important;
        }
        
        /* Draggable Floating Panel Styles */
        .floating-panel {
            position: fixed;
            width: 320px;
            background: rgba(26, 26, 36, 0.95);
            border: 2px solid #A78BFA;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .floating-panel.collapsed {
            width: 165px;
            height: 48px;
            border-radius: 24px;
            overflow: hidden;
        }
        
        .floating-panel.collapsed .panel-header {
            padding: 12px 16px;
            justify-content: center;
            gap: 8px;
            font-size: 0.85rem;
            border-radius: 24px;
        }
        
        .floating-panel.collapsed .panel-title {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .floating-panel.collapsed .panel-content {
            display: none;
        }
        
        .panel-header {
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(52, 211, 153, 0.2));
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #2a2a3a;
        }
        
        .panel-title {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-icon {
            font-size: 1.2rem;
            line-height: 1;
        }
        
        .floating-panel.collapsed .panel-icon {
            display: inline;
        }
        
        .floating-panel:not(.collapsed) .panel-icon {
            display: none;
        }
        
        .panel-controls {
            display: flex;
            gap: 8px;
        }
        
        .panel-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        
        .panel-btn:hover {
            background: rgba(167, 139, 250, 0.3);
            border-color: #A78BFA;
        }
        
        .panel-content {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .panel-section {
            margin-bottom: 20px;
        }
        
        .panel-section:last-child {
            margin-bottom: 0;
        }
        
        .panel-section-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #A78BFA;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-data {
            font-size: 0.9rem;
            line-height: 1.8;
            color: #CBD5E1;
        }
        
        .panel-data-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .panel-data-label {
            color: #94A3B8;
        }
        
        .panel-data-value {
            color: #fff;
            font-weight: 600;
        }
        
        .color-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.85rem;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid;
        }
        
        .legend-color.active {
            background: #2d1b4e;
            border-color: #B4A0E5;
        }
        
        .legend-color.visited {
            background: #1a3a2e;
            border-color: #4ADE80;
        }
        
        .legend-color.neutral {
            background: #1f1f24;
            border-color: #A1A1AA;
        }
        
        .legend-color.goal {
            background: #3a1818;
            border-color: #FB7185;
        }
        
        /* Step Summary Styles */
        .step-summary-wrapper {
            margin-top: 30px;
            border-top: 1px solid #2a2a3a;
            padding-top: 20px;
        }

        .summary-toggle {
            background: transparent;
            border: 1px solid #2a2a3a;
            color: #94A3B8;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
            width: 100%;
            text-align: left;
        }

        .summary-toggle:hover {
            background: #1a1a24;
            border-color: #A78BFA;
            color: #A78BFA;
        }

        .toggle-icon {
            transition: transform 0.2s ease;
            font-size: 0.8rem;
        }

        .summary-toggle.expanded .toggle-icon {
            transform: rotate(90deg);
        }

        .summary-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .summary-content.expanded {
            max-height: 2000px;
            padding-top: 20px;
        }

        .step-item {
            background: #1a1a24;
            border-left: 3px solid var(--step-color, #94A3B8);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .step-number {
            color: var(--step-color, #94A3B8);
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .step-detail {
            margin-bottom: 12px;
        }

        .step-label {
            color: #94A3B8;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .step-value {
            color: #fafafa;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .step-value code {
            background: #0a0a0f;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            color: #A78BFA;
        }
        
        /* Simulation Step Styles */
        .simulation-step {
            margin-bottom: 50px;
            padding: 30px;
            background: rgba(26, 26, 36, 0.5);
            border-radius: 12px;
            border-left: 4px solid var(--tier-color, #94A3B8);
        }

        .step-header {
            color: var(--tier-color, #A78BFA);
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .step-description {
            color: #CBD5E1;
            font-size: 1rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        footer {
            text-align: center;
            margin-top: 80px;
            padding-top: 40px;
            border-top: 2px solid #2a2a3a;
            color: #64748B;
        }
        
        .help-text {
            margin-top: 40px;
            padding: 20px;
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid #FBB036;
            border-radius: 8px;
            color: #FBB036;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé® Revised Graph Designs</h1>
            <p class="subtitle">GHOST Engine - With Draggable Data Panel</p>
            <p style="color: #64748B; margin-top: 10px;">LR layout + Rich node labels + Draggable panel prototype</p>
        </header>

        <!-- Draggable Floating Panel -->
        <div class="floating-panel" id="floatingPanel">
            <div class="panel-header" id="panelHeader">
                <span class="panel-icon">üìä</span>
                <h3 class="panel-title">Graph Data</h3>
                <div class="panel-controls">
                    <button class="panel-btn" id="collapseBtn" title="Collapse/Expand">‚àí</button>
                </div>
            </div>
            <div class="panel-content" id="panelContent">
                <div class="panel-section">
                    <div class="panel-section-title">üìà Current Graph</div>
                    <div class="panel-data" id="currentGraph">
                        Scroll to a graph to see its data
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-section-title">üé® Color Legend</div>
                    <div class="color-legend">
                        <div class="legend-item">
                            <div class="legend-color active"></div>
                            <span>Active/Current</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color visited"></div>
                            <span>Done/Visited</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color neutral"></div>
                            <span>Neutral/Unvisited</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color goal"></div>
                            <span>Goal/Output</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TIER 1: EXPLORER -->
        <section class="tier-section explorer" data-tier="explorer">
            <div class="tier-header">
                <span class="tier-badge explorer">Tier 1</span>
                <h2 class="tier-title">EXPLORER - Dijkstra's Algorithm</h2>
            </div>
            
            <div class="tier-meta">
                <div class="meta-item">
                    <span class="meta-label">Complexity</span>
                    <span class="meta-value">9 Nodes</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Layout</span>
                    <span class="meta-value">LR (Left-Right)</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Concept</span>
                    <span class="meta-value">Shortest Path</span>
                </div>
            </div>
            
            <p class="description">
                <strong>Dijkstra's Algorithm:</strong> Classic greedy pathfinding with priority queue mechanics. 
                Node labels contain distance data. Edge weights show costs. Arrow types indicate path status.
            </p>
            
            <div class="simulation-step">
                <h4 class="step-header">Step 1: Initialization</h4>
                <p class="step-description">Start node A set to distance 0, all other nodes to infinity. Queue contains only A.</p>
                <div class="graph-container">
                    <pre class="mermaid">
flowchart LR
A(["A | dist: 0"])
B(["B | dist: ‚àû"])
C(["C | dist: ‚àû"])
D(["D | dist: ‚àû"])
E(["E | dist: ‚àû"])
F(["F | Goal"])
A -->|"4"| B
A -->|"2"| C
B -->|"3"| D
C -->|"1"| D
C -->|"5"| E
D -->|"2"| E
D -->|"4"| F
E -->|"2"| F
classDef start fill:#1a3a2e,stroke:#4ADE80,stroke-width:3px,color:#fff
classDef unvisited fill:#1f1f24,stroke:#A1A1AA,stroke-width:1px,color:#aaa
classDef goal fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
class A start
class B,C,D,E unvisited
class F goal
                    </pre>
                </div>
            </div>

            <div class="simulation-step">
                <h4 class="step-header">Step 2: First Wave Complete</h4>
                <p class="step-description">Explored A, discovered C (dist=2) and B (dist=4). C is now current node being processed.</p>
                <div class="graph-container">
                    <pre class="mermaid">
flowchart LR
A(["A | done"])
B(["B | dist: 4"])
C(["C | dist: 2"])
D(["D | dist: 3"])
E(["E | dist: 7"])
F(["F | Goal"])
A ==>|"4"| B
A ==>|"2"| C
B -->|"3"| D
C ==>|"1"| D
C ==>|"5"| E
D -->|"2"| E
D -->|"4"| F
E -->|"2"| F
classDef done fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef current fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef discovered fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef unvisited fill:#1f1f24,stroke:#A1A1AA,stroke-width:1px,color:#aaa
classDef goal fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
class A done
class C current
class B,D,E discovered
class F goal
                    </pre>
                </div>
            </div>
            
            <!-- Step Summary Section -->
            <div class="step-summary-wrapper">
                <button class="summary-toggle">
                    <span class="toggle-icon">‚ñ∂</span>
                    <span class="toggle-text">Step-by-Step Analysis</span>
                </button>
                <div class="summary-content">
                    <div class="step-item" style="--step-color: #4ADE80">
                        <div class="step-number">STEP 1: Initialize</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Start node A set to distance 0, all others to infinity</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Foundation of greedy algorithm - always start from a known point</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Unvisited: <code>[]</code> ‚Üí <code>[A:0, B:‚àû, C:‚àû, D:‚àû, E:‚àû, F:‚àû]</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #4ADE80">
                        <div class="step-number">STEP 2: Visit Nearest Node</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Node C selected (distance 2), neighbors B and E updated</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Greedy choice - always pick unvisited node with smallest distance</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Queue: <code>[C:2]</code> ‚Üí <code>[B:4, E:7]</code>, Visited: <code>[A]</code> ‚Üí <code>[A, C]</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #B4A0E5">
                        <div class="step-number">STEP 3: Process Current Node</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Node B selected (distance 4), checking paths to D</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Demonstrates path relaxation - found shorter route to D through B</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">D: <code>‚àû</code> ‚Üí <code>6</code>, Current: <code>B</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #FB7185">
                        <div class="step-number">STEP 4: Reach Goal</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Node F reached with final distance 8, algorithm terminates</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Shortest path guaranteed by greedy optimal substructure property</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Path: <code>A ‚Üí C ‚Üí B ‚Üí D ‚Üí F</code>, Total: <code>8</code></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TIER 2: ENGINEER -->
        <section class="tier-section engineer" data-tier="engineer">
            <div class="tier-header">
                <span class="tier-badge engineer">Tier 2</span>
                <h2 class="tier-title">ENGINEER - Neural Network Backpropagation</h2>
            </div>
            
            <div class="tier-meta">
                <div class="meta-item">
                    <span class="meta-label">Complexity</span>
                    <span class="meta-value">16 Nodes</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Layout</span>
                    <span class="meta-value">LR (Left-Right)</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Concept</span>
                    <span class="meta-value">Gradient Flow</span>
                </div>
            </div>
            
            <p class="description">
                <strong>Backpropagation:</strong> Forward pass (solid arrows) computes activations. 
                Backward pass (dotted arrows) propagates gradients. Node labels show z (pre-activation) and a (activation) values.
            </p>
            
            <div class="simulation-step">
                <h4 class="step-header">Step 1: Forward Pass Complete</h4>
                <p class="step-description">All activations computed through hidden layers. Output Y=0.82, Loss=0.032 calculated.</p>
                <div class="graph-container">
                    <pre class="mermaid">
flowchart LR
subgraph INPUT[Input Layer]
  X1["x1: 1.0"]
  X2["x2: 0.5"]
end
subgraph HIDDEN1[Hidden Layer 1]
  H1["h1 | z:0.8 | a:0.69"]
  H2["h2 | z:0.6 | a:0.65"]
  H3["h3 | z:0.4 | a:0.60"]
end
subgraph HIDDEN2[Hidden Layer 2]
  H4["h4 | z:1.2 | a:0.77"]
  H5["h5 | z:0.9 | a:0.71"]
end
subgraph OUTPUT[Output Layer]
  Y1["y: 0.82"]
  LOSS["Loss: 0.032"]
end
X1 ==>|"w:0.5"| H1
X1 ==>|"w:0.3"| H2
X2 ==>|"w:0.4"| H2
X2 ==>|"w:0.6"| H3
H1 ==>|"w:0.7"| H4
H2 ==>|"w:0.5"| H4
H2 ==>|"w:0.3"| H5
H3 ==>|"w:0.8"| H5
H4 ==>|"w:0.6"| Y1
H5 ==>|"w:0.4"| Y1
Y1 ==> LOSS
classDef input fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef hidden fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef output fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef loss fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
class X1,X2 input
class H1,H2,H3,H4,H5 hidden
class Y1 output
class LOSS loss
                    </pre>
                </div>
            </div>

            <div class="simulation-step">
                <h4 class="step-header">Step 2: Backward Gradient Flow</h4>
                <p class="step-description">Gradients propagate backwards (dotted arrows). Each layer receives error signal to update weights.</p>
                <div class="graph-container">
                    <pre class="mermaid">
flowchart LR
subgraph INPUT[Input Layer]
  X1["x1: 1.0"]
  X2["x2: 0.5"]
end
subgraph HIDDEN1[Hidden Layer 1]
  H1["h1 | ‚àÇ:0.02"]
  H2["h2 | ‚àÇ:0.03"]
  H3["h3 | ‚àÇ:0.01"]
end
subgraph HIDDEN2[Hidden Layer 2]
  H4["h4 | ‚àÇ:0.05"]
  H5["h5 | ‚àÇ:0.07"]
end
subgraph OUTPUT[Output Layer]
  Y1["y: 0.82"]
  LOSS["Loss: 0.032"]
end
subgraph GRADIENTS[Gradient Flow]
  G1["‚àÇL/‚àÇy: -0.18"]
  G2["‚àÇL/‚àÇh4: -0.05"]
  G3["‚àÇL/‚àÇh1: -0.02"]
end
X1 -->|"fwd"| H1
X1 -->|"fwd"| H2
X2 -->|"fwd"| H2
X2 -->|"fwd"| H3
H1 -->|"fwd"| H4
H2 -->|"fwd"| H4
H2 -->|"fwd"| H5
H3 -->|"fwd"| H5
H4 -->|"fwd"| Y1
H5 -->|"fwd"| Y1
Y1 --> LOSS
LOSS ==>|"grad"| G1
G1 -.->|"-0.11"| H4
G1 -.->|"-0.07"| H5
G2 -.->|"-0.03"| H1
G2 -.->|"-0.02"| H2
G3 -.->|"-0.01"| X1
classDef input fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef hidden fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef output fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef loss fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
classDef gradient fill:#2e2414,stroke:#FCD34D,stroke-width:2px,color:#FCD34D
class X1,X2 input
class H1,H2,H3,H4,H5 hidden
class Y1 output
class LOSS loss
class G1,G2,G3 gradient
                    </pre>
                </div>
            </div>
            
            <!-- Step Summary Section -->
            <div class="step-summary-wrapper">
                <button class="summary-toggle">
                    <span class="toggle-icon">‚ñ∂</span>
                    <span class="toggle-text">Step-by-Step Analysis</span>
                </button>
                <div class="summary-content">
                    <div class="step-item" style="--step-color: #4ADE80">
                        <div class="step-number">STEP 1: Forward Pass - Input Layer</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Inputs X1 and X2 propagated through weighted connections to hidden layer 1</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Initial feature transformation - raw inputs converted to learned representations</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">H1: <code>z=0.8, a=0.69</code>, H2: <code>z=0.6, a=0.65</code>, H3: <code>z=0.4, a=0.60</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #4ADE80">
                        <div class="step-number">STEP 2: Forward Pass - Hidden Layer 2</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Hidden layer 1 activations propagated to hidden layer 2 with new weights</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Deep feature learning - hierarchical abstractions built layer by layer</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">H4: <code>z=1.2, a=0.77</code>, H5: <code>z=0.9, a=0.71</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #B4A0E5">
                        <div class="step-number">STEP 3: Output & Loss</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Final layer produces output y=0.82, compared against target to get loss=0.032</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Loss quantifies error - drives learning by measuring prediction quality</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Prediction: <code>0.82</code>, Target: <code>1.0</code>, Loss: <code>0.032</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #FCD34D">
                        <div class="step-number">STEP 4: Backward Pass - Output Gradient</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Gradient ‚àÇL/‚àÇy = -0.18 computed, flows backward to H4 and H5</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Backpropagation begins - error signal flows reverse through network</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Gradients: <code>‚àÇL/‚àÇh4=-0.05, ‚àÇL/‚àÇh5=-0.07</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #FCD34D">
                        <div class="step-number">STEP 5: Backward Pass - Weight Updates</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Gradients propagated to H1, H2, H3, and back to inputs with chain rule</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Learning happens - weights adjusted proportional to their contribution to error</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">All weights updated via gradient descent: <code>w_new = w_old - Œ∑*‚àÇL/‚àÇw</code></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TIER 3: ARCHITECT -->
        <section class="tier-section architect" data-tier="architect">
            <div class="tier-header">
                <span class="tier-badge architect">Tier 3</span>
                <h2 class="tier-title">ARCHITECT - Transformer Block</h2>
            </div>
            
            <div class="tier-meta">
                <div class="meta-item">
                    <span class="meta-label">Complexity</span>
                    <span class="meta-value">22 Nodes</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Layout</span>
                    <span class="meta-value">LR (Left-Right)</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Concept</span>
                    <span class="meta-value">Attention + FFN</span>
                </div>
            </div>
            
            <p class="description">
                <strong>Transformer Architecture:</strong> Complete encoder block with multi-head attention, FFN, and residual connections. 
                Node labels include dimensions. Dotted arrows show residual skip connections.
            </p>
            
            <div class="simulation-step">
                <h4 class="step-header">Step 1: QKV Projection</h4>
                <p class="step-description">Input embeddings projected to Query, Key, Value vectors for 2 attention heads. Dimension reduces from 512d to 64d per head.</p>
                <div class="graph-container">
                    <pre class="mermaid">
flowchart LR
subgraph EMBED[Input Embeddings]
  T1["Token 1 | 512d"]
  T2["Token 2 | 512d"]
  T3["Token 3 | 512d"]
end
subgraph PROJ[QKV Projection]
  Q1["Q1 | 64d"]
  K1["K1 | 64d"]
  V1["V1 | 64d"]
  Q2["Q2 | 64d"]
  K2["K2 | 64d"]
  V2["V2 | 64d"]
end
T1 ==>|"W_Q"| Q1
T1 ==>|"W_K"| K1
T1 ==>|"W_V"| V1
T2 ==>|"W_Q"| Q2
T2 ==>|"W_K"| K2
T2 ==>|"W_V"| V2
classDef embed fill:#1a3a2e,stroke:#4ADE80,stroke-width:3px,color:#fff
classDef proj fill:#2d1b4e,stroke:#B4A0E5,stroke-width:2px,color:#fff
class T1,T2,T3 embed
class Q1,K1,V1,Q2,K2,V2 proj
                    </pre>
                </div>
            </div>

            <div class="simulation-step">
                <h4 class="step-header">Step 2: Attention & Residual Flow</h4>
                <p class="step-description">Multi-head attention computes Q¬∑K^T scores, weighted V sum. Concat heads (128d), add residual, normalize.</p>
                <div class="graph-container">
                    <pre class="mermaid">
flowchart LR
subgraph EMBED[Input Embeddings]
  T1["Token 1"]
  T2["Token 2"]
end
subgraph PROJ[Q, K, V]
  Q1["Q1"]
  K1["K1"]
  V1["V1"]
  Q2["Q2"]
  K2["K2"]
  V2["V2"]
end
subgraph ATT[Attention Heads]
  A1["Head 1 | score:0.8"]
  A2["Head 2 | score:0.6"]
  CONCAT["Concat | 128d"]
end
subgraph NORM1[Add & Norm]
  ADD1["Residual +"]
  LN1["LayerNorm"]
end
Q1 ==> A1
K1 ==> A1
V1 ==> A1
Q2 ==> A2
K2 ==> A2
V2 ==> A2
A1 ==> CONCAT
A2 ==> CONCAT
CONCAT ==> ADD1
T1 -.->|"skip"| ADD1
ADD1 ==> LN1
classDef embed fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef proj fill:#1a3a2e,stroke:#4ADE80,stroke-width:1px,color:#aaa
classDef attention fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef norm fill:#2e2414,stroke:#FCD34D,stroke-width:2px,color:#FCD34D
class T1,T2 embed
class Q1,K1,V1,Q2,K2,V2 proj
class A1,A2,CONCAT attention
class ADD1,LN1 norm
                    </pre>
                </div>
            </div>
            
            <!-- Step Summary Section -->
            <div class="step-summary-wrapper">
                <button class="summary-toggle">
                    <span class="toggle-icon">‚ñ∂</span>
                    <span class="toggle-text">Step-by-Step Analysis</span>
                </button>
                <div class="summary-content">
                    <div class="step-item" style="--step-color: #4ADE80">
                        <div class="step-number">STEP 1: Input Embeddings</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Three tokens converted to 512-dimensional dense embeddings</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Foundation of transformer - continuous vector space enables semantic operations</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Tokens: <code>[T1, T2, T3]</code> ‚Üí Embeddings: <code>3√ó512d vectors</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #4ADE80">
                        <div class="step-number">STEP 2: QKV Projection</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Each token embedding split into Query, Key, Value vectors (64d each) for 2 heads</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Creates attention triplets - Q searches, K matches, V provides information</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">T1: <code>512d</code> ‚Üí <code>Q1:64d, K1:64d, V1:64d</code> (per head)</div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #B4A0E5">
                        <div class="step-number">STEP 3: Multi-Head Attention</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Two attention heads compute Q¬∑K^T/‚àöd, then weighted sum of V, concatenated to 128d</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Core mechanism - tokens attend to each other, learning contextual relationships</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Head1: <code>64d</code>, Head2: <code>64d</code> ‚Üí Concat: <code>128d</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #FCD34D">
                        <div class="step-number">STEP 4: Add & Norm (Residual 1)</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Original embeddings added back (skip connection), then layer normalized</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Residual connections prevent vanishing gradients, enable deep networks</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">Attention: <code>128d</code> + Input: <code>512d</code> ‚Üí Normalized: <code>512d</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #FCD34D">
                        <div class="step-number">STEP 5: Feed Forward Network</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Two linear layers with ReLU: expand to 2048d, then compress back to 512d</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Non-linear transformation - adds expressiveness beyond attention mechanism</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value"><code>512d ‚Üí 2048d (ReLU) ‚Üí 512d</code></div>
                        </div>
                    </div>
                    
                    <div class="step-item" style="--step-color: #FB7185">
                        <div class="step-number">STEP 6: Add & Norm (Residual 2) ‚Üí Output</div>
                        <div class="step-detail">
                            <div class="step-label">What Changed</div>
                            <div class="step-value">Second residual connection + normalization produces final encoder output</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Why It Matters</div>
                            <div class="step-value">Complete transformer block - contextualized representations ready for next layer or task</div>
                        </div>
                        <div class="step-detail">
                            <div class="step-label">Before ‚Üí After</div>
                            <div class="step-value">FFN: <code>512d</code> + Residual ‚Üí Normalized: <code>512d per token</code></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ONE-SHOT TEACHING EXAMPLES -->
        <section class="tier-section oneshot" data-tier="oneshot" style="border: 3px solid #FCD34D; background: rgba(252, 211, 77, 0.05);">
            <div class="tier-header">
                <span class="tier-badge" style="background: linear-gradient(135deg, #FCD34D 0%, #F59E0B 100%);">Teaching Examples</span>
                <h2 class="tier-title">ONE-SHOT EXAMPLES (For LLM Training)</h2>
            </div>
            
            <div class="tier-meta">
                <div class="meta-item">
                    <span class="meta-label">Purpose</span>
                    <span class="meta-value">Reference Examples for LLM</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Total Graphs</span>
                    <span class="meta-value">6 (2 steps √ó 3 tiers)</span>
                </div>
                <div class="meta-item">
                    <span class="meta-label">Status</span>
                    <span class="meta-value">‚ö†Ô∏è AWAITING APPROVAL</span>
                </div>
            </div>
            
            <p class="description" style="background: rgba(252, 211, 77, 0.1); padding: 15px; border-left: 4px solid #FCD34D; margin-bottom: 30px;">
                <strong>‚ö†Ô∏è CRITICAL:</strong> These are the one-shot examples from <code>prompts.py</code> that the LLM uses to learn the "perfect" output format.
                If these examples contain errors (wrong node counts, direction statements, bad syntax), the LLM will copy those mistakes in every simulation it generates.
                <br><br>
                <strong>Please review and approve/reject before proceeding with prompt revisions.</strong>
            </p>

            <!-- EXPLORER TIER -->
            <div style="background: rgba(167, 139, 250, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <h3 style="color: #A78BFA; margin-bottom: 20px;">üìò EXPLORER Tier - Dijkstra's Algorithm</h3>
                
                <div class="simulation-step">
                    <h4 class="step-header">Explorer Step 0: Initialization 
                        <span style="color: #4ADE80; font-weight: 600;">[6 nodes - Target: 8-10]</span>
                        <span style="color: #FB7185; font-weight: 600;">‚ö†Ô∏è BELOW TARGET</span>
                    </h4>
                    <p class="step-description">Node count: A, B, C, D, E, F = 6 nodes (Target range: 8-10 nodes)</p>
                    <div class="graph-container">
                        <pre class="mermaid">
flowchart LR
A(["A | dist: 0"])
B(["B | dist: ‚àû"])
C(["C | dist: ‚àû"])
D(["D | dist: ‚àû"])
E(["E | dist: ‚àû"])
F(["F | Goal"])
A -->|"4"| B
A -->|"2"| C
B -->|"3"| D
C -->|"1"| D
C -->|"5"| E
D -->|"2"| E
D -->|"4"| F
E -->|"2"| F
classDef start fill:#1a3a2e,stroke:#4ADE80,stroke-width:3px,color:#fff
classDef unvisited fill:#1f1f24,stroke:#A1A1AA,stroke-width:1px,color:#aaa
classDef goal fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
class A start
class B,C,D,E unvisited
class F goal
                        </pre>
                    </div>
                </div>

                <div class="simulation-step">
                    <h4 class="step-header">Explorer Step 1: First Wave Complete 
                        <span style="color: #4ADE80; font-weight: 600;">[6 nodes - Target: 8-10]</span>
                        <span style="color: #FB7185; font-weight: 600;">‚ö†Ô∏è BELOW TARGET</span>
                    </h4>
                    <p class="step-description">Node count: A, B, C, D, E, F = 6 nodes (Target range: 8-10 nodes)</p>
                    <div class="graph-container">
                        <pre class="mermaid">
flowchart LR
A(["A | done"])
B(["B | dist: 4"])
C(["C | dist: 2"])
D(["D | dist: 3"])
E(["E | dist: 7"])
F(["F | Goal"])
A ==>|"4"| B
A ==>|"2"| C
B -->|"3"| D
C ==>|"1"| D
C ==>|"5"| E
D -->|"2"| E
D -->|"4"| F
E -->|"2"| F
classDef done fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef current fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef discovered fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef unvisited fill:#1f1f24,stroke:#A1A1AA,stroke-width:1px,color:#aaa
classDef goal fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
class A done
class C current
class B,D,E discovered
class F goal
                        </pre>
                    </div>
                </div>
            </div>

            <!-- ENGINEER TIER -->
            <div style="background: rgba(96, 165, 250, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <h3 style="color: #60A5FA; margin-bottom: 20px;">‚öôÔ∏è ENGINEER Tier - Backpropagation</h3>
                
                <div class="simulation-step">
                    <h4 class="step-header">Engineer Step 0: Forward Pass Complete 
                        <span style="color: #FB7185; font-weight: 600;">[9 nodes - Target: 15-18]</span>
                        <span style="color: #FB7185; font-weight: 600;">‚ö†Ô∏è BELOW TARGET</span>
                    </h4>
                    <p class="step-description">Node count: X1, X2, H1, H2, H3, H4, H5, Y1, LOSS = 9 nodes (Target range: 15-18 nodes)</p>
                    <div class="graph-container">
                        <pre class="mermaid">
flowchart LR
subgraph INPUT[Input Layer]
  X1["x1: 1.0"]
  X2["x2: 0.5"]
end
subgraph HIDDEN1[Hidden Layer 1]
  H1["h1 | z:0.8 | a:0.69"]
  H2["h2 | z:0.6 | a:0.65"]
  H3["h3 | z:0.4 | a:0.60"]
end
subgraph HIDDEN2[Hidden Layer 2]
  H4["h4 | z:1.2 | a:0.77"]
  H5["h5 | z:0.9 | a:0.71"]
end
subgraph OUTPUT[Output Layer]
  Y1["y: 0.82"]
  LOSS["Loss: 0.032"]
end
X1 ==>|"w:0.5"| H1
X1 ==>|"w:0.3"| H2
X2 ==>|"w:0.4"| H2
X2 ==>|"w:0.6"| H3
H1 ==>|"w:0.7"| H4
H2 ==>|"w:0.5"| H4
H2 ==>|"w:0.3"| H5
H3 ==>|"w:0.8"| H5
H4 ==>|"w:0.6"| Y1
H5 ==>|"w:0.4"| Y1
Y1 ==> LOSS
classDef input fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef hidden fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef output fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef loss fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
class X1,X2 input
class H1,H2,H3,H4,H5 hidden
class Y1 output
class LOSS loss
                        </pre>
                    </div>
                </div>

                <div class="simulation-step">
                    <h4 class="step-header">Engineer Step 1: Backward Gradient Flow 
                        <span style="color: #FB7185; font-weight: 600;">[12 nodes - Target: 15-18]</span>
                        <span style="color: #FB7185; font-weight: 600;">‚ö†Ô∏è BELOW TARGET</span>
                    </h4>
                    <p class="step-description">Node count: X1, X2, H1, H2, H3, H4, H5, Y1, LOSS, G1, G2, G3 = 12 nodes (Target range: 15-18 nodes)</p>
                    <div class="graph-container">
                        <pre class="mermaid">
flowchart LR
subgraph INPUT[Input Layer]
  X1["x1: 1.0"]
  X2["x2: 0.5"]
end
subgraph HIDDEN1[Hidden Layer 1]
  H1["h1 | ‚àÇ:0.02"]
  H2["h2 | ‚àÇ:0.03"]
  H3["h3 | ‚àÇ:0.01"]
end
subgraph HIDDEN2[Hidden Layer 2]
  H4["h4 | ‚àÇ:0.05"]
  H5["h5 | ‚àÇ:0.07"]
end
subgraph OUTPUT[Output Layer]
  Y1["y: 0.82"]
  LOSS["Loss: 0.032"]
end
subgraph GRADIENTS[Gradient Flow]
  G1["‚àÇL/‚àÇy: -0.18"]
  G2["‚àÇL/‚àÇh4: -0.05"]
  G3["‚àÇL/‚àÇh1: -0.02"]
end
X1 -->|"fwd"| H1
X1 -->|"fwd"| H2
X2 -->|"fwd"| H2
X2 -->|"fwd"| H3
H1 -->|"fwd"| H4
H2 -->|"fwd"| H4
H2 -->|"fwd"| H5
H3 -->|"fwd"| H5
H4 -->|"fwd"| Y1
H5 -->|"fwd"| Y1
Y1 --> LOSS
LOSS ==>|"grad"| G1
G1 -.->|"-0.11"| H4
G1 -.->|"-0.07"| H5
G2 -.->|"-0.03"| H1
G2 -.->|"-0.02"| H2
G3 -.->|"-0.01"| X1
classDef input fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef hidden fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef output fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef loss fill:#3a1818,stroke:#FB7185,stroke-width:2px,color:#fff
classDef gradient fill:#2e2414,stroke:#FCD34D,stroke-width:2px,color:#FCD34D
class X1,X2 input
class H1,H2,H3,H4,H5 hidden
class Y1 output
class LOSS loss
class G1,G2,G3 gradient
                        </pre>
                    </div>
                </div>
            </div>

            <!-- ARCHITECT TIER -->
            <div style="background: rgba(52, 211, 153, 0.1); padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <h3 style="color: #34D399; margin-bottom: 20px;">üèóÔ∏è ARCHITECT Tier - Transformer</h3>
                
                <div class="simulation-step">
                    <h4 class="step-header">Architect Step 0: QKV Projection 
                        <span style="color: #FB7185; font-weight: 600;">[9 nodes - Target: 20-25]</span>
                        <span style="color: #FB7185; font-weight: 600;">‚ö†Ô∏è FAR BELOW TARGET</span>
                    </h4>
                    <p class="step-description">Node count: T1, T2, T3, Q1, K1, V1, Q2, K2, V2 = 9 nodes (Target range: 20-25 nodes)</p>
                    <div class="graph-container">
                        <pre class="mermaid">
flowchart LR
subgraph EMBED[Input Embeddings]
  T1["Token 1 | 512d"]
  T2["Token 2 | 512d"]
  T3["Token 3 | 512d"]
end
subgraph PROJ[QKV Projection]
  Q1["Q1 | 64d"]
  K1["K1 | 64d"]
  V1["V1 | 64d"]
  Q2["Q2 | 64d"]
  K2["K2 | 64d"]
  V2["V2 | 64d"]
end
T1 ==>|"W_Q"| Q1
T1 ==>|"W_K"| K1
T1 ==>|"W_V"| V1
T2 ==>|"W_Q"| Q2
T2 ==>|"W_K"| K2
T2 ==>|"W_V"| V2
classDef embed fill:#1a3a2e,stroke:#4ADE80,stroke-width:3px,color:#fff
classDef proj fill:#2d1b4e,stroke:#B4A0E5,stroke-width:2px,color:#fff
class T1,T2,T3 embed
class Q1,K1,V1,Q2,K2,V2 proj
                        </pre>
                    </div>
                </div>

                <div class="simulation-step">
                    <h4 class="step-header">Architect Step 1: Attention & Residual 
                        <span style="color: #FB7185; font-weight: 600;">[13 nodes - Target: 20-25]</span>
                        <span style="color: #FB7185; font-weight: 600;">‚ö†Ô∏è FAR BELOW TARGET</span>
                    </h4>
                    <p class="step-description">Node count: T1, T2, Q1, K1, V1, Q2, K2, V2, A1, A2, CONCAT, ADD1, LN1 = 13 nodes (Target range: 20-25 nodes)</p>
                    <div class="graph-container">
                        <pre class="mermaid">
flowchart LR
subgraph EMBED[Input Embeddings]
  T1["Token 1"]
  T2["Token 2"]
end
subgraph PROJ[Q, K, V]
  Q1["Q1"]
  K1["K1"]
  V1["V1"]
  Q2["Q2"]
  K2["K2"]
  V2["V2"]
end
subgraph ATT[Attention Heads]
  A1["Head 1 | score:0.8"]
  A2["Head 2 | score:0.6"]
  CONCAT["Concat | 128d"]
end
subgraph NORM1[Add & Norm]
  ADD1["Residual +"]
  LN1["LayerNorm"]
end
Q1 ==> A1
K1 ==> A1
V1 ==> A1
Q2 ==> A2
K2 ==> A2
V2 ==> A2
A1 ==> CONCAT
A2 ==> CONCAT
CONCAT ==> ADD1
T1 -.->|"skip"| ADD1
ADD1 ==> LN1
classDef embed fill:#1a3a2e,stroke:#4ADE80,stroke-width:2px,color:#fff
classDef proj fill:#1a3a2e,stroke:#4ADE80,stroke-width:1px,color:#aaa
classDef attention fill:#2d1b4e,stroke:#B4A0E5,stroke-width:3px,color:#fff
classDef norm fill:#2e2414,stroke:#FCD34D,stroke-width:2px,color:#FCD34D
class T1,T2 embed
class Q1,K1,V1,Q2,K2,V2 proj
class A1,A2,CONCAT attention
class ADD1,LN1 norm
                        </pre>
                    </div>
                </div>
            </div>

            <div style="background: rgba(251, 113, 133, 0.1); padding: 20px; border-radius: 8px; margin-top: 30px; border: 2px solid #FB7185;">
                <h3 style="color: #FB7185; margin-bottom: 15px;">‚ö†Ô∏è VERDICT: All One-Shot Examples Below Target</h3>
                <ul style="color: #fafafa; line-height: 2;">
                    <li><strong>Explorer:</strong> 6 nodes (need 8-10) - Missing 2-4 nodes</li>
                    <li><strong>Engineer:</strong> 9-12 nodes (need 15-18) - Missing 3-9 nodes</li>
                    <li><strong>Architect:</strong> 9-13 nodes (need 20-25) - Missing 7-16 nodes</li>
                </ul>
                <p style="margin-top: 15px; color: #FCD34D;">
                    <strong>Recommendation:</strong> These examples need to be expanded to match the target node counts before proceeding with prompt revisions.
                    The LLM will copy these examples, so they must showcase the complexity level we want to see in generated simulations.
                </p>
            </div>
        </section>

        <div class="help-text">
            <strong>üí° Try the Draggable Panel!</strong><br>
            Drag the floating panel around the screen, collapse it, then reload the page to see position persistence.
        </div>

        <footer>
            <p>GHOST Engine ¬© 2026 | Graph Design System v2</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">LR layout + Rich node labels + Existing color palette + Draggable panel prototype</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#1a1a24',
                primaryColor: '#2d2640',
                primaryTextColor: '#fff',
                primaryBorderColor: '#A78BFA',
                lineColor: '#94A3B8',
                secondaryColor: '#1a2533',
                tertiaryColor: '#1a2e26',
                fontSize: '14px',
                clusterBkg: 'rgba(167, 139, 250, 0.08)',
                clusterBorder: '#A78BFA'
            },
            flowchart: {
                curve: 'basis',
                padding: 20,
                nodeSpacing: 80,
                rankSpacing: 100
            }
        });

        // Draggable Panel Logic
        const panel = document.getElementById('floatingPanel');
        const panelHeader = document.getElementById('panelHeader');
        const collapseBtn = document.getElementById('collapseBtn');
        const panelContent = document.getElementById('panelContent');
        const currentGraphDiv = document.getElementById('currentGraph');

        // Load saved position from localStorage
        const savedPosition = JSON.parse(localStorage.getItem('panelPosition') || '{"x": 20, "y": 100}');
        const savedCollapsed = localStorage.getItem('panelCollapsed') === 'true';

        panel.style.left = savedPosition.x + 'px';
        panel.style.top = savedPosition.y + 'px';

        if (savedCollapsed) {
            panel.classList.add('collapsed');
            collapseBtn.textContent = '+';
        }

        // Make panel draggable
        let isDragging = false;
        let currentX, currentY, initialX, initialY;

        panelHeader.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
            if (e.target === collapseBtn || e.target.closest('.panel-btn')) return;
            
            initialX = e.clientX - savedPosition.x;
            initialY = e.clientY - savedPosition.y;
            isDragging = true;
            panel.style.cursor = 'grabbing';
            panel.style.transition = 'none'; // Disable transitions for smooth drag
        }

        function drag(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;

            panel.style.left = currentX + 'px';
            panel.style.top = currentY + 'px';
        }

        function dragEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            panel.style.cursor = '';
            panel.style.transition = ''; // Re-enable transitions
            
            // Save position
            savedPosition.x = currentX;
            savedPosition.y = currentY;
            localStorage.setItem('panelPosition', JSON.stringify(savedPosition));
        }

        // Collapse/Expand
        collapseBtn.addEventListener('click', () => {
            panel.classList.toggle('collapsed');
            const isCollapsed = panel.classList.contains('collapsed');
            collapseBtn.textContent = isCollapsed ? '+' : '‚àí';
            localStorage.setItem('panelCollapsed', isCollapsed);
        });

        // Update panel content based on visible section
        const tierData = {
            explorer: `
                <div class="panel-data-row">
                    <span class="panel-data-label">Algorithm:</span>
                    <span class="panel-data-value">Dijkstra</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Nodes:</span>
                    <span class="panel-data-value">6 graph + 3 state</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Current:</span>
                    <span class="panel-data-value">Node B (dist: 4)</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Queue:</span>
                    <span class="panel-data-value">[C:2, B:4, D:5]</span>
                </div>
            `,
            engineer: `
                <div class="panel-data-row">
                    <span class="panel-data-label">Architecture:</span>
                    <span class="panel-data-value">2‚Üí3‚Üí2‚Üí1</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Forward:</span>
                    <span class="panel-data-value">Activations computed</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Backward:</span>
                    <span class="panel-data-value">Gradients flowing</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Loss:</span>
                    <span class="panel-data-value">0.032</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Max Gradient:</span>
                    <span class="panel-data-value">‚àÇL/‚àÇy: -0.18</span>
                </div>
            `,
            architect: `
                <div class="panel-data-row">
                    <span class="panel-data-label">Architecture:</span>
                    <span class="panel-data-value">Transformer Block</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Tokens:</span>
                    <span class="panel-data-value">3 √ó 512d</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Attention Heads:</span>
                    <span class="panel-data-value">2 parallel heads</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">FFN Dims:</span>
                    <span class="panel-data-value">512‚Üí2048‚Üí512</span>
                </div>
                <div class="panel-data-row">
                    <span class="panel-data-label">Residuals:</span>
                    <span class="panel-data-value">2 skip connections</span>
                </div>
            `
        };

        // Intersection Observer to detect which section is in view
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const tier = entry.target.dataset.tier;
                    currentGraphDiv.innerHTML = tierData[tier];
                }
            });
        }, { threshold: 0.5 });

        document.querySelectorAll('.tier-section').forEach(section => {
            observer.observe(section);
        });

        // Step Summary Toggle
        document.querySelectorAll('.summary-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                this.classList.toggle('expanded');
                const content = this.nextElementSibling;
                content.classList.toggle('expanded');
            });
        });

        // Test rendering status
        window.addEventListener('load', function() {
            setTimeout(() => {
                const svgs = document.querySelectorAll('.mermaid svg');
                console.log(`‚úÖ ${svgs.length}/3 graphs rendered successfully`);
                
                if (svgs.length === 3) {
                    console.log('üéâ All graphs rendered with LR layout!');
                } else {
                    console.error(`‚ùå Only ${svgs.length} graphs rendered.`);
                }
            }, 3000);
        });
    </script>
</body>
</html>
